# rust_js_sync_codegen

A utility crate for generating JavaScript code from Rust constants at build time, ensuring a single source of truth for shared values between Rust and JavaScript.

## Use Case

When you have constants that need to be shared between Rust code and JavaScript code (e.g., in a Deno runtime), manually keeping them in sync is error-prone. This crate allows you to define the constants once in Rust and automatically generate the corresponding JavaScript code at build time.

## Usage

### In your `build.rs`:

```rust
use rust_js_sync_codegen::{JsCodegen, JsValue, numbers_to_js_array};

// Define your constants in Rust
const MY_CONSTANTS: &[u32] = &[100, 200, 300];

fn main() {
    let mut codegen = JsCodegen::new();
    
    // Add constants
    codegen.add_const("MY_CONSTANTS", numbers_to_js_array(MY_CONSTANTS));
    
    // Or add exported constants
    codegen.add_export("PUBLIC_CONSTANTS", numbers_to_js_array(MY_CONSTANTS));
    
    // Generate the JavaScript
    let js_code = codegen.generate();
    
    // Write to file
    std::fs::write("generated.js", js_code).unwrap();
}
```

### Generated Output:

```javascript
// AUTO-GENERATED CODE - DO NOT EDIT
// This file was generated by rust_js_sync_codegen

const MY_CONSTANTS = [100, 200, 300];
export const PUBLIC_CONSTANTS = [100, 200, 300];
```

## API

### `JsCodegen`

The main code generator struct.

```rust
let mut codegen = JsCodegen::new();
codegen.add_const("NAME", value);  // Non-exported constant
codegen.add_export("NAME", value); // Exported constant
let code = codegen.generate();     // Generate JS string
codegen.write_to_file("path.js")?; // Write directly to file
```

### `JsValue`

Represents JavaScript values:

- `JsValue::Number(i64)` - Number literal
- `JsValue::String(String)` - String literal (auto-escaped)
- `JsValue::Boolean(bool)` - Boolean literal
- `JsValue::Array(Vec<JsValue>)` - Array
- `JsValue::Object(Vec<(String, JsValue)>)` - Object
- `JsValue::Null` - Null value

### Helper Functions

- `numbers_to_js_array<T>(&[T]) -> JsValue` - Convert number slice to JS array
- `strings_to_js_array(&[&str]) -> JsValue` - Convert string slice to JS array

## Example: Shared TypeScript Diagnostic Codes

See `pctx_type_check_runtime` for a real-world example where TypeScript diagnostic codes are shared between:
- Rust code that filters diagnostics
- JavaScript code that runs type checking
- Rust tests that verify the filtering behavior

## Features

- **Type-safe**: Values are validated at Rust compile time
- **Auto-escaping**: Strings are properly escaped for JavaScript
- **Build-time generation**: No runtime overhead
- **Single source of truth**: Define once in Rust, use everywhere

## License

MIT
